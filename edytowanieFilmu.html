<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baza filmów</title>
    <link rel="shortcut icon" href="movie.png" type="image/x-icon">
    <link rel="stylesheet" href="style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" 
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <script src="config.js"></script>
</head>
<body>
    <div class="container">
        <header>

            <div id="TopLeft">
                <a href="index.html"><img src="movie.png" alt="logo" width="60" height="60"></a>
                <a href="index.html"><button type="button" class="btn btn-light">Baza filmów</button></a>
                <a href="o-nas.html"><button type="button" class="btn btn-light">O nas</button></a>
                <a href="kontakt.html"><button type="button" class="btn btn-light">Kontakt</button></a>
            </div>

            <div id="TopRight">
                <a class="icon-link icon-link-hover" style="--bs-icon-link-transform: translate3d(0, -.125rem, 0);" href="dodawanieFilmu.html">
                    <button type="button" class="btn btn-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-upload" viewBox="0 0 16 16">
                        <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/>
                        <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708z"/>
                      </svg>
                      &nbsp;Dodaj film
                    </button>
                  </a>
            </div>

        </header>

        <div class="container mt-4 search-div">
            <div class="d-flex justify-content-center mt-3">
                <h1 class="fw-bold">Edytuj film</h1>
            </div>
        </div>

        <main>
            <div class="container">
                <form id="editFilmForm">
                    <input type="hidden" name="id" id="id">
                    <label for="title">Tytuł: </label><br>
                    <input type="text" name="title" id="title" required><br><br>
                    <label for="imdbrating">Ranking IMDB: </label><br>
                    <input type="text" name="imdbrating" id="imdbrating"><br><br>
                    <label for="imageURL">Link do zdjęcia: </label><br>
                    <input type="url" name="imageURL" id="imageURL" placeholder="http://www.example.com" required><br><br>
                    <label for="prodYear">Rok produkcji: </label><br>
                    <input type="number" name="prodYear" id="prodYear" min="1900" max="2099" step="1" value="2025" required ><br><br>
                    <label for="category1">Kategorie:</label><br>
                    <select name="category1" id="category1" required>
                        <option value="Akcja">Akcja</option> 
                        <option value="Dramat">Dramat</option>
                        <option value="Komedia">Komedia</option>
                        <option value="Horror">Horror</option>
                        <option value="Sci-Fi">Sci-Fi</option>
                        <option value="Przygodowy">Przygodowy</option>
                        <option value="Animacja">Animacja</option>
                        <option value="Thriller">Thriller</option>
                        <option value="Fantasy">Fantasy</option>
                        <option value="Romans">Romans</option>
                        <option value="Dokumentalny">Dokumentalny</option>
                        <option value="Musical">Musical</option>
                        <option value="Historyczny">Historyczny</option>
                        <option value="Western">Western</option>
                        <option value="Kryminał">Kryminał</option>
                    </select>
                    <select name="category2" id="category2" required>
                        <option value="Akcja">Akcja</option> 
                        <option value="Dramat">Dramat</option>
                        <option value="Komedia">Komedia</option>
                        <option value="Horror">Horror</option>
                        <option value="Sci-Fi">Sci-Fi</option>
                        <option value="Przygodowy">Przygodowy</option>
                        <option value="Animacja">Animacja</option>
                        <option value="Thriller">Thriller</option>
                        <option value="Fantasy">Fantasy</option>
                        <option value="Romans">Romans</option>
                        <option value="Dokumentalny">Dokumentalny</option>
                        <option value="Musical">Musical</option>
                        <option value="Historyczny">Historyczny</option>
                        <option value="Western">Western</option>
                        <option value="Kryminał">Kryminał</option>
                        <option value="Brak">Brak drugiej kategorii</option>
                    </select><br><br>
                    <label for="description">Opis:</label><br>
                    <textarea name="description" id="description"></textarea><br><br>
                    <label for="awards">Nagrody: </label><br>
                    <input type="text" name="awards" id="awards"><br><br>
                    <button type="submit" class="btn btn-primary">Edytuj film</button>
                </form>
            </div>
        </main>

        <footer class="container mt-4">
            <br><br><br>
            <hr>
    
            <div id="BottomLeft">
                <a href="index.html" id="BazaFilmow"><h6>Baza filmów</h6></a><br>
                <a href="https://www.facebook.com/" target="_blank"><i class="bi bi-facebook"></i></a> &nbsp;
                <a href="https://www.instagram.com/" target="_blank"><i class="bi bi-instagram"></i></a> &nbsp;
                <a href="https://x.com/" target="_blank"><i class="bi bi-twitter-x"></i></a><br>
                Stronę wykonali: uczniowie technikum
            </div>
    
            <div id="BottomRight">
            <a href="o-nas.html"><button type="button" class="btn btn-link">O nas</button></a><br>
            <a href="kontakt.html"><button type="button" class="btn btn-link">Kontakt</button></a><br>
            </div>
    
        </footer>

    </div>
    <script>
        document.getElementById("editFilmForm").addEventListener("submit", async function(event){
            event.preventDefault();
            const passId = window.location.search;
            const urlParams = new URLSearchParams(passId);
            const getId = urlParams.get('id');
            let formData = new FormData(this);
            formData.append("id", getId);
            const apiurl = window.API_URL + 'edit';
            const request = {
                method: 'PUT',
                headers: {
                'Content-Type': 'application/json',
                },
                body: JSON.stringify(Object.fromEntries(formData))
            };
            let response = await fetch(apiurl, request);

            let result = await response.json();
            
            let cat1 = document.getElementById("category1");
            let cat2 = document.getElementById("category2");

            if (cat1.value == cat2.value) {
                alert("Nie możesz ustawić dwóch tych samych kategori!!");
            } else {
                alert("Pomyślnie edytowano film!");
            }
            window.location.replace("index.html");
        });

    </script>
</body>
</html>
